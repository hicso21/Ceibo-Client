{"ast":null,"code":"import _toConsumableArray from\"/home/tomas/p5/checkpoints/Ceibo/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/tomas/p5/checkpoints/Ceibo/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Fragment}from\"react\";import{Container,Paper,Typography,Divider,Grid,List,ListItem,ListItemText,FormControl,TextField,IconButton}from\"@mui/material\";import SendIcon from\"@mui/icons-material/Send\";import{Box}from\"@mui/system\";import{useState,useEffect}from\"react\";import{useSelector}from\"react-redux\";import\"./Chat.css\";import{useLocation}from\"react-router\";import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var connectionOptions={\"force new connection\":true,reconnection:true,reconnectionDelay:2000,//starts with 2 secs delay, then 4, 6, 8, until 60 where it stays forever until it reconnects\nreconnectionDelayMax:60000,//1 minute maximum delay between connections\nreconnectionAttempts:\"Infinity\",//to prevent dead clients, having the user to having to manually reconnect after a server restart.\ntimeout:10000,//before connect_error and connect_timeout are emitted.\ntransports:[\"websocket\"]//forces the transport to be only websocket. Server needs to be setup as well/\n};var socket=require(\"socket.io-client\")(\"http://localhost:3001\",connectionOptions);export default function Chat(){socket.on(\"connect\",function(){//console.log(socket.id); // x8WIv7-mJelg7on_ALbx\n});socket.on(\"disconnect\",function(){//console.log(socket.id); // undefined\n});var _useLocation=useLocation(),pathname=_useLocation.pathname;var fId=pathname.split(\"/\")[2];var _useSelector=useSelector(function(state){return state;}),user=_useSelector.user;var uId=user._id;var username=user.name;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),chatMessages=_useState2[0],setChatMessages=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var handlerMessageChange=function handlerMessageChange(event){setMessage(event.target.value);};var handlerSubmit=function handlerSubmit(e){e.preventDefault();if(user&&message){socket.emit(\"send-message\",{message:message,uId:uId,fId:fId,username:username});setMessage(\"\");}};useEffect(function(){axios.get(\"http://localhost:3001/api/messages/\".concat(fId,\"/\").concat(uId)).then(function(res){setChatMessages(res.data);});},[]);useEffect(function(){var receiveMessage=function receiveMessage(message){setChatMessages([].concat(_toConsumableArray(chatMessages),[message]));//console.log(\"receive message\", message);\n};socket.on(\"new-message\",receiveMessage);return function(){socket.off(\"new-message\",receiveMessage);};},[chatMessages]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Fragment,{children:/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsx(Paper,{elevation:5,children:/*#__PURE__*/_jsxs(Box,{p:8,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Chat con la fundacion\"}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:4,alignItems:\"center\",children:[/*#__PURE__*/_jsx(Grid,{id:\"chat-window\",xs:12,item:true,children:/*#__PURE__*/_jsx(List,{id:\"chat-window-messages\",children:chatMessages.map(function(chat,index){return/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:\"\".concat(chat.user,\": \").concat(chat.message)},chat.user)},index);})})}),/*#__PURE__*/_jsx(Grid,{xs:10,item:true,children:/*#__PURE__*/_jsx(FormControl,{fullWidth:true,children:/*#__PURE__*/_jsx(TextField,{onChange:handlerMessageChange,value:message,label:\"Escribe tu mensaje\",variant:\"outlined\"})})}),/*#__PURE__*/_jsx(Grid,{xs:1,item:true,children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"Enviar\",onClick:handlerSubmit,children:/*#__PURE__*/_jsx(SendIcon,{})})})]})]})})})})});}","map":{"version":3,"names":["Fragment","Container","Paper","Typography","Divider","Grid","List","ListItem","ListItemText","FormControl","TextField","IconButton","SendIcon","Box","useState","useEffect","useSelector","useLocation","axios","connectionOptions","reconnection","reconnectionDelay","reconnectionDelayMax","reconnectionAttempts","timeout","transports","socket","require","Chat","on","pathname","fId","split","state","user","uId","_id","username","name","chatMessages","setChatMessages","message","setMessage","handlerMessageChange","event","target","value","handlerSubmit","e","preventDefault","emit","get","then","res","data","receiveMessage","off","map","chat","index"],"sources":["/home/tomas/p5/checkpoints/Ceibo/client/src/components/Chat/Chat.jsx"],"sourcesContent":["import { Fragment } from \"react\";\nimport {\n  Container,\n  Paper,\n  Typography,\n  Divider,\n  Grid,\n  List,\n  ListItem,\n  ListItemText,\n  FormControl,\n  TextField,\n  IconButton,\n} from \"@mui/material\";\nimport SendIcon from \"@mui/icons-material/Send\";\nimport { Box } from \"@mui/system\";\nimport { useState, useEffect } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport \"./Chat.css\";\nimport { useLocation } from \"react-router\";\nimport axios from \"axios\";\n\nconst connectionOptions = {\n  \"force new connection\": true,\n  reconnection: true,\n  reconnectionDelay: 2000, //starts with 2 secs delay, then 4, 6, 8, until 60 where it stays forever until it reconnects\n  reconnectionDelayMax: 60000, //1 minute maximum delay between connections\n  reconnectionAttempts: \"Infinity\", //to prevent dead clients, having the user to having to manually reconnect after a server restart.\n  timeout: 10000, //before connect_error and connect_timeout are emitted.\n  transports: [\"websocket\"], //forces the transport to be only websocket. Server needs to be setup as well/\n};\nconst socket = require(\"socket.io-client\")(\n  \"http://localhost:3001\",\n  connectionOptions\n);\n\nexport default function Chat() {\n  socket.on(\"connect\", () => {\n    //console.log(socket.id); // x8WIv7-mJelg7on_ALbx\n  });\n\n  socket.on(\"disconnect\", () => {\n    //console.log(socket.id); // undefined\n  });\n\n  const { pathname } = useLocation();\n  const fId = pathname.split(\"/\")[2];\n  const { user } = useSelector((state) => state);\n  const uId = user._id;\n  const username = user.name;\n\n  const [chatMessages, setChatMessages] = useState([]);\n  const [message, setMessage] = useState(\"\");\n\n  const handlerMessageChange = (event) => {\n    setMessage(event.target.value);\n  };\n\n  const handlerSubmit = (e) => {\n    e.preventDefault();\n    if (user && message) {\n      socket.emit(\"send-message\", { message, uId, fId, username });\n      setMessage(\"\");\n    }\n  };\n\n  useEffect(() => {\n    axios\n      .get(`http://localhost:3001/api/messages/${fId}/${uId}`)\n      .then((res) => {\n        setChatMessages(res.data);\n      });\n  }, []);\n\n  useEffect(() => {\n    const receiveMessage = (message) => {\n      setChatMessages([...chatMessages, message]);\n      //console.log(\"receive message\", message);\n    };\n\n    socket.on(\"new-message\", receiveMessage);\n\n    return () => {\n      socket.off(\"new-message\", receiveMessage);\n    };\n  }, [chatMessages]);\n\n  return (\n    <>\n      <Fragment>\n        <Container>\n          <Paper elevation={5}>\n            <Box p={8}>\n              <Typography variant=\"h5\" gutterBottom>\n                Chat con la fundacion\n              </Typography>\n              <Divider />\n              <Grid container spacing={4} alignItems=\"center\">\n                <Grid id=\"chat-window\" xs={12} item>\n                  <List id=\"chat-window-messages\">\n                    {chatMessages.map((chat, index) => {\n                      return (\n                        <ListItem key={index}>\n                          <ListItemText\n                            key={chat.user}\n                            primary={`${chat.user}: ${chat.message}`}\n                          />\n                        </ListItem>\n                      );\n                    })}\n                  </List>\n                </Grid>\n                {/*  <Grid item>\n                  <FormControl fullWidth>\n                    <TextField value={user.name} variant=\"outlined\" />\n                  </FormControl>\n                </Grid> */}\n                <Grid xs={10} item>\n                  <FormControl fullWidth>\n                    <TextField\n                      onChange={handlerMessageChange}\n                      value={message}\n                      label=\"Escribe tu mensaje\"\n                      variant=\"outlined\"\n                    />\n                  </FormControl>\n                </Grid>\n                <Grid xs={1} item>\n                  <IconButton aria-label=\"Enviar\" onClick={handlerSubmit}>\n                    <SendIcon />\n                  </IconButton>\n                </Grid>\n              </Grid>\n            </Box>\n          </Paper>\n        </Container>\n      </Fragment>\n    </>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}